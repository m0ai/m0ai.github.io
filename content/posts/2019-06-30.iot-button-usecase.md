---
title: "ë†€ê³  ìˆëŠ” AWS IOT Buttonì„ ìŠ¬ë™ ë©”ì„¸ì§€ ë³´ë‚´ê¸°"
date: 2019-06-30T22:20:13+09:00
draft: false
categories: [development, aws]
tags: [aws, iot-button, automation]
author: m0ai
---

# ë†€ê³  ìˆëŠ” AWS IOT Button ì„ í™œìš©í•˜ê¸°
ì§‘ì—ì„œ ë°©ì¹˜ë˜ì–´ìˆëŠ” AWS IoT ë²„íŠ¼ì„ 10ë¶„ì„ íˆ¬ìí•´ì„œ ì‹¤ìš©ì ì¸ ì¥ë‚œê°ìœ¼ë¡œ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì„¤ì •í•˜ê¸°ë¥¼ ì™„ë£Œí•˜ë©´ aws lambdaë¥¼ ì´ìš©í•˜ì—¬ ê°„ë‹¨í•˜ê²Œ ìŠ¬ë™ ë©”ì„¸ì§€ë¥¼ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. 

# í•„ìš”ì‚¬í•­
```
- terraform 0.13
- python3.9
- ì§‘ì—ì„œ ë†€ê³  ìˆëŠ” AWS IoT ë²„íŠ¼ 1ê°œ
-  aws ê³„ì •
```

# ì„¤ì •í•˜ê¸°

## ë©”ì„¸ì§€ë¥¼ ë³´ë‚¼ ëŒë‹¤ í•¨ìˆ˜ ì¤€ë¹„í•˜ê¸°

ì•„ë˜ `make` ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ì—¬ aws ê³„ì •ì— ì—…ë¡œë“œí•  lambda í•¨ìˆ˜ë¥¼ ì¤€ë¹„í•©ë‹ˆë‹¤.

```bash
make configure # lambdaì—ì„œ ì‚¬ìš©í•  requests íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤.
make publish   # lambdaì— ì—…ë¡œë“œí•  zipì„ ìƒì„±í•©ë‹ˆë‹¤.
```

## AWS ì¸í”„ë¼ êµ¬ì„±í•˜ê¸°

í…Œë¼í¼ì„ ì‚¬ìš©í•´ì„œ AWS ì¸í”„ë¼ë¥¼ êµ¬ì„±í•  ê²ƒ ì…ë‹ˆë‹¤. ë³µì¡í•˜ê²Œ ì½˜ì†”ì—ì„œ ìì›ì„ ìƒì„±í•˜ì§€ ì•Šê³  ê°„ë‹¨í•œ ëª…ë ¹ì–´ë¡œ ë©”ì„¸ì§€ë¥¼ ë³´ë‚´ëŠ” ëŒë‹¤ í•¨ìˆ˜, ì—­í•  ê¶Œí•œì„ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì‚¬ì „ì— `AWS_PROFILE` í™˜ê²½ë³€ìˆ˜ë¥¼ ì„¤ì •í•˜ì—¬ ì •ìƒì ìœ¼ë¡œ ì»¤ë§¨ë“œë¼ì¸ì—ì„œ aws ìì›ì— ì ‘ê·¼ê°€ëŠ¥í•˜ë„ë¡ ì‚¬ì „ ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤. ë§Œì•½ ì´ëŸ¬í•œ ì‚¬ì „ ì„¤ì •ì´ ë˜ì–´ìˆì§€ ì•Šìœ¼ë©´  [AWS Command Line Interface ì„¤ì •í•˜ê¸°](https://docs.aws.amazon.com/ko_kr/cli/latest/userguide/cli-configure-profiles.html) ë¬¸ì„œë¥¼ ì°¸ê³ í•˜ì—¬ ê¶Œí•œ ì„¤ì •ì„ ì™„ë£Œí•´ì•¼í•©ë‹ˆë‹¤.

`AWS_PROFILE` ì„¤ì •ì´ ì™„ë£Œë˜ì—ˆë‹¤ë©´ ë‚´ í™˜ê²½ì— ë§ë„ë¡ í…Œë¼í¼ íŒŒì¼ì„ ìˆ˜ì •í•´ì•¼í•©ë‹ˆë‹¤. ì•„ë˜ëŠ” `./terraform/main.tf` ì— ìˆëŠ” ë‚´ìš©ì…ë‹ˆë‹¤. í•´ë‹¹ íŒŒì¼ì˜ ë‚´ìš©ì„ ìˆ˜ì •í•´ì„œ ì‚¬ìš©í•˜ë„ë¡ í•©ë‹ˆë‹¤. ì•„ë˜ì˜ ê°’ë“¤ì„ ë³€ê²½í•´ì•¼í•©ë‹ˆë‹¤.

- slack_incomming_hook_url

`message` ì— ì •ì˜ë˜ì–´ ìˆëŠ” `single_click`, `double_click`, `long_click` ì€ ë²„íŠ¼ì„ ëˆŒë €ì„ ì‹œ ìŠ¬ë™ìœ¼ë¡œ ë°œì†¡ë  ë¬¸ìì…ë‹ˆë‹¤. ì ì ˆí•œ ê°’ìœ¼ë¡œ ë³€ê²½í•´ì„œ ì‚¬ìš©í•˜ë©´ ë” ì¬ë¯¸ìˆì„ê±°ì—ìš”. :)


```hcl
# ./terraform/main.tf
provider "aws" {
  region  = "ap-northeast-2"
}

terraform {
  required_version = ">= 0.13"
  required_providers {
    aws = {
      source = "hashicorp/aws"
    }
  }
}


module "simple-iot-button-to-slack" {
  source = "https://github.com/m0ai/IotButton2Slack//modules/simple-iot-button-to-slack"

  slack_incomming_hook_url = "YOUR_INCOMMING_WEBHOOK_URL"

  lambda = {
    function_name = "iot_button_2_slack_notification"
    filename = "../lambda.zip"
    handler=  "lambda_function.lambda_handler"
    runtime = "python3.8"
  }

  message = {
    single_click = "Single Click"
    double_click = "Double Click"
    long_click   = "Long Click"
  }
}
```

`/terraform/main.tf` íŒŒì¼ì´ ë³€ê²½ì´ ì™„ë£Œë˜ê³  í•´ë‹¹ ìì›ì„ AWSì— ë°°í¬í•˜ëŠ” ê³¼ì •ì´ í•„ìš”í•©ë‹ˆë‹¤. ë°©ê¸ˆ ìˆ˜ì •í•œ í…Œë¼í¼ íŒŒì¼ì´ ìˆëŠ” ê²½ë¡œì— ë“¤ì–´ê°€ ì•„ë˜ì˜ í…Œë¼í¼ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.


```bash
cd ./terraform
terraform plan
terraform apply
```
ì •ìƒì ìœ¼ë¡œ `terraform apply` ê³¼ì •ì´ ì™„ë£Œë˜ì—ˆìœ¼ë©´ ìŠ¬ë™ì— ë©”ì„¸ì§€ë¥¼ ë³´ë‚¼ lambda í•¨ìˆ˜ê°€ ì¤€ë¹„ë˜ì–´ ìˆëŠ” ìƒíƒœê°€ ë©ë‹ˆë‹¤. í•˜ì§€ë§Œ í˜„ì¬ IoT ë²„íŠ¼ê³¼ lambda ì‚¬ì´ì—ëŠ” ì–´ë– í•œ ì—°ê²°ê³ ë¦¬ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

ë¶ˆí–‰í•˜ê²Œë„ ì´ëŸ¬í•œ ì—°ê²°ê³ ë¦¬ë¥¼ terraform ìœ¼ë¡œ í•œë²ˆì— ì„¤ì •í•  ìˆ˜ ìˆìœ¼ë©´ ì¢‹ê² ì§€ë§Œ, ì•„ì§ (2020.10) ê¸°ì¤€ìœ¼ë¡œ lambda ì™€ iot ë²„íŠ¼ì„ ì—°ë™í•˜ê¸°ì—ëŠ” ë„ˆë¬´ë‚˜ ë²…ì°¬ ê³¼ì •ì„ ê±°ì³ì•¼í•©ë‹ˆë‹¤. ê·¸ë ‡ê¸°ì— í•´ë‹¹ ê³¼ì •ì€ ìˆ˜ë™ìœ¼ë¡œ ì§„í–‰í•˜ëŠ” ê²ƒì´ ê±´ê°•ì— ì´ë¡­ìŠµë‹ˆë‹¤. ğŸ˜‚

## IoT ë²„íŠ¼ê³¼ ì¸í”„ë¼ ì—°ê²°í•˜ê¸°

[aws lambda í™ˆí˜ì´ì§€](https://ap-northeast-2.console.aws.amazon.com/lambda/home?)ì— ì ‘ì†í•˜ì—¬ í…Œë¼í¼ìœ¼ë¡œ ìƒì„±ëœ `iot_button_2_slack_notification` í•¨ìˆ˜ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•´ë‹¹ í•¨ìˆ˜ë¥¼ ëˆŒëŸ¬ `Configuration` ë§¤ë‰´ì— ì ‘ì†í•©ë‹ˆë‹¤. ì´ì— IoT ë²„íŠ¼ê³¼ì˜ ì—°ë™ì„ ì˜í•´ `Add Trigger` ì„ ëˆŒëŸ¬ì„œ íŠ¸ë¦¬ê±° ì„¤ì •ì„ ì§„í–‰í•´ì•¼í•©ë‹ˆë‹¤.

ì´í›„ ì„¹ì…˜ì—ì„œ í•„ìš”í•œ í•­ëª©(Device Serial Number)ì„ ì±„ì›Œ `ì¸ì¦ì„œ ë° í‚¤ ìƒì„±` ë²„íŠ¼ì„ ëˆ„ë¦…ë‹ˆë‹¤ . ê·¸ëŸ¬ë©´ ì•„ë˜ì™€ ì¸ì¦ì„œë¥¼ ì„¤ì •í•˜ì—¬ IoT ë²„íŠ¼ì— ìƒëª…ì„ ë¶ˆì–´ë„£ëŠ” ì‘ì—…ì„ ì§„í–‰í•˜ë©´ ë²„íŠ¼ê³¼ ëŒë‹¤ í•¨ìˆ˜ì˜ ì—°ê²°ì´ ì™„ë£Œë©ë‹ˆë‹¤.

![image-20201015030304158](https://github.com/m0ai/IotButton2Slack/raw/master/img/iot-button-configure-page.png)

ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ì´ì œ ë²„íŠ¼ì„ ëˆŒëŸ¬ ë²„íŠ¼ì„ ì‚¬ìš©í•´ë´…ì‹œë‹¤ ^0^

# ê²°ê³¼

![image-20201015031139768](https://github.com/m0ai/IotButton2Slack/raw/master/img/result.png)



> ì „ì²´ ì½”ë“œëŠ” [github.com/m0ai/IotButton2Slack](https://github.com/m0ai/IotButton2Slack/)ì—ì„œ í™•ì¸ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.



## Inspired by

- [ìš°ì•„í•œ í˜•ì œë“¤ - ì°¨ì„ë²¨](http://woowabros.github.io/study/2016/10/28/woowahan_chime_bell.html)
- [ë‹¹ê·¼ë§ˆì¼“ - í™”ë¶„ ë¬¼ì£¼ê¸° ì•Œë¦¼ì´](https://medium.com/daangn/%ED%9A%8C%EC%82%AC-%ED%99%94%EB%B6%84%EC%97%90-%EC%A3%BC%EA%B8%B0%EC%A0%81%EC%9C%BC%EB%A1%9C-%EB%AC%BC%EC%A3%BC%EA%B8%B0-aws-iot-%EB%B2%84%ED%8A%BC-%ED%99%9C%EC%9A%A9-%EC%82%AC%EB%A1%80-99978e57a59c)
